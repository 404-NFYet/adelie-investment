Implement the following plan:

# LXD 이슈 해결 + 브랜치 정리 + 문서 최신화 + Git 타임라인 계획

> Part C 배포 후 LXD 이슈 해결 + 원격 브랜치 정리 + 문서 최신화 + develop→main PR 타임라인 구성

---

## 0. 현황 요약

| 항목 | 상태 |
|------|------|
| develop | 최신 (1e04722, 2026-02-22) |
| main | develop보다 **212 커밋 뒤** (2026-02-14 이후 업데이트 없음) |
| 원격 브랜치 총수 | 26개 (정리 대상 8-9개) |
| CLAUDE.md | 미커밋 변경사항 존재 (Skills 가이드 추가) |
| changes/ 담당자 파일 | 2026-02-17 이후 미업데이트 |
| backend-api (LXD) | dev-j2hoon10, dev-jjjh02, dev-hj = UNHEALTHY |
| frontend dev 이미지 | 전 서버 로컬 빌드 필요 |

---

## 1. LXD 이슈 해결 (즉시)

### 1-A. backend-api UNHEALTHY 수정 (dev-j2hoon10, dev-jjjh02, dev-hj)

**원인**: `.env`의 `JWT_SECRET`이 기본값 `narrative-invest-jwt-secret-change-in-production`
→ `fastapi/app/main.py` 시작 시 의도적으로 RuntimeError 발생

```bash
for srv in dev-j2hoon10 dev-jjjh02 dev-hj; do
  echo "=== $srv ==="
  lxc exec $srv -- bash -c "
    ENV_FILE=\$(ls ~/adelie-investment/.env /home/ubuntu/adelie-investment/.env 2>/dev/null | head -1)
    DIR=\$(dirname \$ENV_FILE)
    NEW_JWT=\$(openssl rand -hex 32)
    sed -i \"s|JWT_SECRET=.*|JWT_SECRET=\$NEW_JWT|\" \$ENV_FILE
    cd \$DIR && docker compose -f docker-compose.dev.yml restart backend-api
    sleep 8
    docker compose -f docker-compose.dev.yml ps backend-api
  "
done
```

### 1-B. frontend dev 이미지 로컬 빌드 (5대 전체)

**원인**: `docker-compose.dev.yml`의 `dorae222/adelie-frontend-dev:latest`는 Docker Hub 미존재
→ `Dockerfile.dev` (Vite HMR) 기반 로컬 빌드 필요

```bash
for srv in dev-yj99son dev-j2hoon10 dev-jjjh02 dev-ryejinn dev-hj; do
  lxc exec $srv -- bash -c "
    cd ~/adelie-investment 2>/dev/null || cd /home/ubuntu/adelie-investment
    docker compose -f docker-compose.dev.yml build frontend 2>&1 | tail -3
    docker compose -f docker-compose.dev.yml up -d frontend
  "
done
```

### 1-C. staging SSH 설정 추가

`/home/hj/.ssh/config` 끝에 추가:
```
Host staging
  HostName 10.10.10.21
  User ubuntu
  IdentityFile ~/.ssh/id_ed25519
```

### 1-D. `lxd/Makefile` 개선 (2개 타겟 추가, sync-lxd 강화)

**파일**: `lxd/Makefile`

추가할 타겟:
- `health-lxd`: 5대 서버 git/docker 상태 한눈에 보기
- `fix-lxd-jwt`: JWT 기본값 서버 자동 수정
- `sync-lxd` 강화: git pull 후 build frontend + up -d 포함

---

## 2. 브랜치 역할 재정의 + 정리

### 브랜치 역할 명확화 (사용자 확인)

| 브랜치 | 실제 역할 | 비고 |
|--------|---------|------|
| `main` | **프로젝트 소개용** (README/docs) | 실개발 반영 불필요 |
| `develop` | **실질적 메인 개발 브랜치** | 모든 기능 통합 |
| `prod` | **배포 서버 브랜치** (deploy-test) | develop과 동기화 필요 |
| `entire/checkpoints/v1` | 체크포인트 시스템 | 절대 삭제 금지 |
| `dev/*` | 팀원 개인 작업 브랜치 | 5개 유지 |

### 2-A. 삭제 대상: 완료된 chore 싱크 브랜치 + 구식 브랜치 (7개)

> **기준**: 0 ahead (develop에 모두 포함됨) + 역할 종료 + 100 커밋 이상 뒤처짐

| 브랜치 | 삭제 이유 | ahead/behind |
|--------|----------|-------------|
| `chore/pipeline-sync-interface-9715036-core` | 싱크 완료, 0 ahead | 0 / 102 |
| `chore/pipeline-sync-interface-9715036-local-compat` | 동상 | 0 / 115 |
| `chore/sync-pipeline-e2e-to-dev-pipeline` | 싱크 완료, 역할 끝 | 0 / 116 |
| `chore/sync-backend-e2e-to-dev-backend` | 동상 | 0 / 110 |
| `chore/sync-frontend-e2e-to-dev-frontend` | 동상 | 0 / 116 |
| `dev/frontend-ui-v1` | 심각한 분기 (170/326), 현행 구조와 불일치 | 170 / 326 |
| `feature/infra-aws-localstack` | LocalStack → Terraform으로 대체됨 | 3 / 114 |

```bash
BRANCHES_TO_DELETE=(
  "chore/pipeline-sync-interface-9715036-core"
  "chore/pipeline-sync-interface-9715036-local-compat"
  "chore/sync-pipeline-e2e-to-dev-pipeline"
  "chore/sync-backend-e2e-to-dev-backend"
  "chore/sync-frontend-e2e-to-dev-frontend"
  "dev/frontend-ui-v1"
  "feature/infra-aws-localstack"
)
for b in "${BRANCHES_TO_DELETE[@]}"; do
  git push origin --delete "$b"
  git branch -d "$b" 2>/dev/null || true
done
```

### 2-B. 유지 대상 (활성 + 보존 필요)

| 브랜치 | 유지 이유 |
|--------|---------|
| `entire/checkpoints/v1` | 체크포인트, 삭제 금지 |
| `main` | 프로젝트 소개 (README) |
| `develop` | 개발 메인 |
| `prod` | 배포 서버 브랜치 |
| `dev/frontend`, `dev/backend`, `dev/chatbot`, `dev/pipeline`, `dev/infra` | 팀원 작업 브랜치 |
| `feat/agent-canvas-v3-yj99son` | YJ99Son 활성 (2026-02-22) |
| `dev/backend-tutor-user-sessions` | jjjh02 활성 (2026-02-20) |
| `hotfix/chatbot` | j2hoon10, 17 커밋 (검토 필요) |
| `hotfix/pipeline` | ryejinn, 7 커밋 (검토 필요) |
| `feature/pipeline-branch-parser` | ryejinn 파이프라인 작업 |
| `dev/news` | 뉴스 크롤러 개선 (6 커밋 앞섬) |
| `wip/j2hoon10-chatbot` | WIP 보존 |
| `chore/agent-config` | codex 설정 |
| `feat/keywords-icon-mapping-stabilization` | 확인 후 결정 |

### 2-C. prod 브랜치 develop과 동기화

```bash
# prod를 develop 최신으로 업데이트
git checkout prod
git merge develop --no-edit
git push origin prod
git checkout develop
```

---

## 3. 문서 최신화

### 3-A. CLAUDE.md 커밋 (미커밋 변경사항)

현재 `CLAUDE.md`에 작업 영역별 도구 활용 가이드 섹션이 추가되어 있으나 미커밋.
→ 다른 미커밋 변경들(datapipeline, fastapi 등)과 분리하여 별도 커밋.

> ⚠️ **커밋 메시지 규칙**: AI 도구 사용 흔적 금지 — "Skills 가이드", "Claude Code", "AI Agent" 등 표현 사용 불가.
> 커밋은 dorae222(dhj9842@gmail.com) 계정으로, 일반적인 팀원 작업처럼 보여야 함.

```bash
git add CLAUDE.md
git commit -m "docs: 작업 영역별 개발 도구 및 컨벤션 가이드 정리"
```

### 3-B. changes/ 담당자별 파일 업데이트

**현황**: 5개 파일 모두 2026-02-17 이후 미업데이트 (5일 경과)
**목표**: 2026-02-22 현재 진행 상황 반영

각 담당자 파일에 추가할 내용:

| 파일 | 추가 내용 |
|------|---------|
| `changes/dorae222.md` | LXD 인프라 개선, JWT 수정, frontend 빌드 자동화, IAM 문서, Terraform 배포, staging SSH |
| `changes/YJ99Son.md` | Agent Canvas v5 (캐러셀, soft guardrail), 모바일 반응형 완료, Playwright E2E |
| `changes/J2hoon10.md` | 튜터 UX 개선, 토큰 자동 갱신, chatbot 가드레일 고도화 |
| `changes/jjjh02.md` | 세션-유저 연결, 유저별 세션 조회/삭제, FastAPI repository 계층 |
| `changes/ryejinn.md` | 파이프라인 KST 날짜 통일, hotfix/pipeline, E2E 테스트 확장 |

### 3-C. docs/ 업데이트 대상 확인

- `docs/reference/changelog.md` — 최근 기능 추가 내역 반영
- `docs/architecture/overview.md` — Agent Canvas, AWS Terraform 추가
- `docs/team-guides/E_인프라_도형준.md` — LXD 운영 개선, staging 서버, AWS Terraform 추가

---

## 4. Git 타임라인 정리 (develop 중심)

### 4-A. 역할 재확인

| 브랜치 | 역할 | 동기화 방향 |
|--------|------|------------|
| `develop` | 실질 메인 | ← feature/* PR |
| `prod` | 배포 서버 | ← develop merge |
| `main` | 프로젝트 소개 | README만 유지, 기능 반영 불필요 |

### 4-B. hotfix 브랜치 검토 (결정 전 확인 필수)

```bash
# hotfix/chatbot 내용 확인 (17 커밋, PR #21 닫혔음)
git log develop..hotfix/chatbot --oneline
git diff develop...hotfix/chatbot --stat
gh pr view 21  # 왜 닫혔는지 확인

# hotfix/pipeline 내용 확인 (7 커밋)
git log develop..hotfix/pipeline --oneline
git diff develop...hotfix/pipeline --stat
```

**처리 기준:**
- develop에 이미 포함된 변경만 있으면 → 브랜치 삭제
- develop에 없는 고유 변경 있으면 → develop으로 PR 생성 후 병합

### 4-C. 활성 feature 브랜치 → develop PR 계획

현재 develop에 아직 미반영된 활성 작업들을 논리적 순서로 PR:

| # | 브랜치 | 담당자 | 내용 | 커밋 수 | 예정 |
|---|--------|--------|------|--------|------|
| 1 | `hotfix/pipeline` | ryejinn | 파이프라인 KST 핫픽스 | 7 | 검토 후 즉시 |
| 2 | `hotfix/chatbot` | j2hoon10 | 챗봇 가드레일, 추천 질문 | 17 | 검토 후 결정 |
| 3 | `dev/backend-tutor-user-sessions` | jjjh02 | 세션-유저 연결 | 미확인 | 이번 주 |
| 4 | `dev/news` | (누구?) | 뉴스 크롤러 개선 | 6 | 이번 주 |
| 5 | `feature/pipeline-branch-parser` | ryejinn | 파이프라인 브랜치 파서 | 1 | 이번 주 |
| 6 | `feat/agent-canvas-v3-yj99son` | YJ99Son | Agent Canvas v5 UX | 多 | YJ99Son 완료 후 |
| 7 | `wip/j2hoon10-chatbot` | j2hoon10 | Proactive 챗봇 제안 | 1 | WIP 완료 후 |

### 4-D. develop → prod 동기화 계획

```bash
# prod를 develop 최신으로 업데이트 (배포 전)
git checkout prod
git merge develop --no-edit -m "chore: prod 브랜치 develop 동기화 (2026-02-22)"
git push origin prod
git checkout develop
```

**주기**: feature PR이 develop에 쌓일 때마다 (또는 deploy-test 배포 전) prod 동기화

### 4-E. Git 태그로 마일스톤 표시

develop의 주요 완료 시점에 태그 추가:

```bash
# 현재 시점에서 의미 있는 태그들
git tag -a v0.1 <최초 기본 구조 커밋> -m "v0.1: 프로젝트 초기 구조"
git tag -a v0.5 <auth 완료 커밋> -m "v0.5: FastAPI 인증 + DB 기본 구조"
git tag -a v1.0 <pipeline 첫 배포 커밋> -m "v1.0: LangGraph 파이프라인 + 첫 배포"
git tag -a v1.1 <agent-canvas 머지 커밋> -m "v1.1: Agent Canvas + 모바일 반응형"
git tag -a v1.2 HEAD -m "v1.2: AWS Terraform IaC + LXD 자동화"
git push origin --tags
```

### 4-F. main 브랜치 README 최신화

main은 프로젝트 소개용이므로 README.md만 업데이트:
```bash
git checkout main
# README.md 에 현재 기능 목록, 데모 URL, 팀 소개 업데이트
git add README.md
git commit -m "docs: 프로젝트 소개 및 아키텍처 개요 업데이트"
git push origin main
git checkout develop
```

---

## ⚠️ 커밋 메시지 공통 규칙

모든 커밋에서 반드시 지켜야 할 사항:
- AI 도구 사용 흔적 **금지**: "Claude Code", "Skills 가이드", "AI Agent", "Generated with", "Co-Authored-By" 등 표현 사용 불가
- 커밋은 **dorae222 (dhj9842@gmail.com)** 계정으로, 자연스러운 팀원 작업처럼 작성
- 형식: `type: 한글 설명` (예: `chore: LXD 개발 환경 자동화 스크립트 추가`)

---

## 5. 실행 순서

### Phase 1: LXD 이슈 해결 (30분)
1. JWT_SECRET 3대 수정 + backend-api restart (1-A)
2. frontend dev 빌드 5대 (1-B)
3. staging SSH config 추가 (1-C)
4. `lxd/Makefile` 개선 (1-D) — `health-lxd`, `fix-lxd-jwt` 추가, `sync-lxd` 강화

### Phase 2: 브랜치 정리 (10분)
5. 삭제 대상 7개 원격 브랜치 삭제 (2-A)
6. prod → develop 동기화 (2-C)
7. dev-yj99son git rebase — YJ99Son에게 알림 (자동 불가)

### Phase 3: hotfix 브랜치 검토 (10분)
8. hotfix/chatbot (17 커밋) 내용 확인 → PR 또는 삭제 결정
9. hotfix/pipeline (7 커밋) 내용 확인 → PR 또는 삭제 결정

### Phase 4: 문서 최신화 (20분)
10. CLAUDE.md 커밋 (3-A)
11. `changes/dorae222.md` 업데이트 (3-B)
12. `docs/team-guides/E_인프라_도형준.md` 업데이트 (3-C)
13. main README 최신화 (4-F)

### Phase 5: Git 태그 + 타임라인 (10분)
14. develop에 v0.1~v1.2 태그 추가 (4-E)
15. 활성 feature 브랜치 PR 일정 팀 공유

---

## 6. 수정 파일 목록

| 파일 | 작업 |
|------|------|
| `lxd/Makefile` | `health-lxd`, `fix-lxd-jwt` 추가, `sync-lxd` build 단계 강화 |
| `/home/hj/.ssh/config` | `staging` (10.10.10.21) 호스트 추가 |
| `CLAUDE.md` | 미커밋 변경사항 커밋 |
| `changes/dorae222.md` | 최근 작업 내역 추가 (2026-02-22 기준) |
| `docs/team-guides/E_인프라_도형준.md` | AWS Terraform, LXD 자동화 개선 내역 추가 |
| `README.md` (main 브랜치) | 현재 기능 목록, 데모 URL 최신화 |

---

## 7. 검증

```bash
# LXD 전체 헬스체크 (Makefile 개선 후)
make -f lxd/Makefile health-lxd

# 브랜치 정리 확인
git branch -r | wc -l  # 26 → 19 예상

# staging 연결 테스트
ssh staging 'hostname'

# deploy-test 프로덕션 (항상 확인)
ssh deploy-test "curl -sf http://localhost:8082/api/v1/health"

# prod 브랜치 동기화 확인
git log prod..develop --oneline | wc -l  # 0 이어야 함

# 태그 확인
git tag -l | sort -V
```


If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /home/hj/.REDACTED.jsonl

---

Playwright E2E 작성 및 테스트는 끝났는가?

---

[Request interrupted by user for tool use]