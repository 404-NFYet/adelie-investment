Implement the following plan:

# Docker & LXD ê°œë°œí™˜ê²½ ìˆ˜ì • + ì½”ë“œ ì‹±í¬ ë¬¸ì„œí™”

## í˜„ì¬ ì§„í–‰ ìƒí™© (2026-02-19)

### âœ… ì™„ë£Œ (ì½”ë“œ ìˆ˜ì •, ë¯¸ì»¤ë°‹ ìƒíƒœ)
- `lxd/scripts/setup-dev-env.sh` â€” ë¡œì»¬ DB ì¸ì¦ì •ë³´ 3ê³³ ìˆ˜ì •
- `docker-compose.dev.yml` â€” db-migrate command ìˆ˜ì •
- `Makefile` â€” deploy-test ë¸Œëœì¹˜ ìˆ˜ì •, sync/migrate íƒ€ê²Ÿ ì¶”ê°€
- `lxd/docs/sync-guide.md` â€” ì‹ ê·œ ë¬¸ì„œ ì‘ì„±

### âŒ ë¯¸ì™„ë£Œ (ë‹¤ìŒ ì‹¤í–‰ í•„ìš”)
- **Step 5**: ì»¤ë°‹ & push
- **Step 6**: Frontend Docker ì´ë¯¸ì§€ ì¬ë¹Œë“œ â†’ push â†’ deploy-test ì¬ë°°í¬
- **Step 7**: `make sync-dev-branches` â€” dev/* 5ê°œ ë¸Œëœì¹˜ì— develop 40ì»¤ë°‹ ë³‘í•© & push
- **Step 8**: `make sync-lxd` â€” ê° LXD ì„œë²„ì—ì„œ git pull ì‹¤í–‰

### ë¸Œëœì¹˜ í˜„í™©
- dev/* ë¸Œëœì¹˜ë“¤ì´ developë³´ë‹¤ 40ì»¤ë°‹ ë’¤ì²˜ì§ (develop â†’ dev/* ì‹±í¬ í•„ìš”)
- develop ìì²´ì— ì•„ì§ uncommitted ë³€ê²½ì‚¬í•­ ìˆìŒ (Step 5 ë¨¼ì €)

---

## Context

---

## ë°œê²¬ëœ ë¬¸ì œ ìƒì„¸

### Issue 1: `setup-dev-env.sh` ë¡œì»¬ DB ì¸ì¦ì •ë³´ ë¶ˆì¼ì¹˜

| í•­ëª© | í˜„ì¬ (ì˜ëª»ë¨) | ì˜¬ë°”ë¦„ |
|------|-------------|--------|
| POSTGRES_DB | `adelie_db` | `narrative_invest` |
| POSTGRES_USER | `adelie` | `narative` |
| POSTGRES_PASSWORD | `adelie` | `password` |
| DATABASE_URL | `adelie:adelie@.../adelie_db` | `narative:password@.../narrative_invest` |
| alembic ëŒ€ê¸° | `pg_isready -U adelie -d adelie_db` | `pg_isready -U narative -d narrative_invest` |

### Issue 2: `docker-compose.dev.yml` db-migrate ì»¤ë§¨ë“œ

```yaml
# í˜„ì¬ (ë¬¸ì œ)
command: sh -c "cd /app/database && alembic upgrade heads"
# "heads" (ë³µìˆ˜) â†’ ë‹¨ì¼ íˆìŠ¤í† ë¦¬ì—ì„œëŠ” "head" ì‚¬ìš© ê¶Œì¥
# PYTHONPATH ë¯¸ì„¤ì • â†’ production Docker ì´ë¯¸ì§€ì—ì„  ë™ì‘ ë¶ˆì•ˆì •

# ì˜¬ë°”ë¦„
command: sh -c "cd /app && PYTHONPATH=/app alembic -c database/alembic.ini upgrade head"
```

### Issue 3: Makefile `deploy-test` ë¸Œëœì¹˜ ë¶ˆì¼ì¹˜

```makefile
# í˜„ì¬ (ì˜ëª»ë¨) â€” line 112
ssh deploy-test 'cd ~/adelie-investment && git pull origin prod && ...'

# ë¬¸ì œ: deploy-testëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì´ë¯€ë¡œ develop ë¸Œëœì¹˜ ì‚¬ìš©í•´ì•¼ í•¨
# prod ë¸Œëœì¹˜ëŠ” ë³„ë„ì˜ production ì„œë²„(ë¯¸ìš´ì˜)ìš©
# ì‹¤ì œ ë°°í¬ ì‹œ ìˆ˜ë™ìœ¼ë¡œ developì„ ì§€ì •í•´ì™”ìŒ
```

### Issue 4: ë¸Œëœì¹˜ í˜„í™©

- `dev/frontend`, `dev/backend`, `dev/chatbot`, `dev/pipeline`, `dev/infra` ëª¨ë‘ developë³´ë‹¤ 40ì»¤ë°‹ ë’¤ì²˜ì§
- ê° LXD ì„œë²„ì˜ ë¡œì»¬ ì½”ë“œë„ êµ¬ë²„ì „ (git pull ë¯¸ì‹¤í–‰)
- Frontend Docker ì´ë¯¸ì§€: êµ¬ë²„ì „ (ì˜¤ëŠ˜ ì»¤ë°‹ c529710, 1dfc826 ë¯¸ë°˜ì˜)

---

## ìˆ˜ì • ê³„íš

### Step 1: `lxd/scripts/setup-dev-env.sh` ìˆ˜ì •

**íŒŒì¼**: `lxd/scripts/setup-dev-env.sh`

**(A) Step 7 ë¡œì»¬ docker-compose.yml â€” DB ì¸ì¦ì •ë³´ (line 193~227)**
```yaml
# ë³€ê²½ ì „                   â†’ ë³€ê²½ í›„
POSTGRES_DB: adelie_db     â†’ POSTGRES_DB: narrative_invest
POSTGRES_USER: adelie      â†’ POSTGRES_USER: narative
POSTGRES_PASSWORD: adelie  â†’ POSTGRES_PASSWORD: password
pg_isready -U adelie ...   â†’ pg_isready -U narative -d narrative_invest
```

**(B) Step 9 ë¡œì»¬ .env DATABASE_URL (line ~308~311)**
```bash
# ë³€ê²½ ì „
REDACTED://adelie:adelie@localhost:5432/adelie_db
SYNC_DATABASE_URL=postgresql://adelie:adelie@localhost:5432/adelie_db

# ë³€ê²½ í›„
REDACTED://narative:password@localhost:5432/narrative_invest
SYNC_DATABASE_URL=postgresql://narative:password@localhost:5432/narrative_invest
```

**(C) Step 12 Alembic ëŒ€ê¸° ì»¨í…Œì´ë„ˆ ëª…ë ¹ (line ~380)**
```bash
# ë³€ê²½ ì „
docker exec adelie-postgres pg_isready -U adelie -d adelie_db

# ë³€ê²½ í›„
docker exec adelie-postgres pg_isready -U narative -d narrative_invest
```

### Step 2: `docker-compose.dev.yml` db-migrate ì»¤ë§¨ë“œ ìˆ˜ì •

**íŒŒì¼**: `docker-compose.dev.yml` (line 128)

```yaml
# ë³€ê²½ ì „
command: sh -c "cd /app/database && alembic upgrade heads"

# ë³€ê²½ í›„
command: sh -c "cd /app && PYTHONPATH=/app alembic -c database/alembic.ini upgrade head"
```

### Step 3: `Makefile` ìˆ˜ì • ë° íƒ€ê²Ÿ ì¶”ê°€

**íŒŒì¼**: `Makefile`

**(A) deploy-test / deploy-test-service ë¸Œëœì¹˜ ìˆ˜ì • (line 112, 119)**
```makefile
# ë³€ê²½ ì „
git pull origin prod

# ë³€ê²½ í›„
git pull origin develop
```

**(B) ìƒˆ íƒ€ê²Ÿ ì¶”ê°€ â€” `sync-dev-branches`**

develop â†’ ëª¨ë“  dev/* ë¸Œëœì¹˜ ìë™ ë³‘í•© & push:
```makefile
sync-dev-branches:
	@echo "ğŸ”€ develop â†’ dev/* ë¸Œëœì¹˜ ì‹±í¬..."
	@git config user.name "dorae222" && git config user.email "dhj9842@gmail.com"
	@for BRANCH in dev/frontend dev/backend dev/chatbot dev/pipeline dev/infra; do \
		echo "  â†’ $$BRANCH"; \
		git checkout $$BRANCH 2>/dev/null && \
		git merge develop --no-edit -m "chore: develop ì‹±í¬ ($$(date +%Y-%m-%d))" 2>/dev/null && \
		git push origin $$BRANCH; \
	done
	@git checkout develop
	@echo "âœ… ëª¨ë“  dev/* ë¸Œëœì¹˜ ì‹±í¬ ì™„ë£Œ"
```

**(C) ìƒˆ íƒ€ê²Ÿ ì¶”ê°€ â€” `sync-lxd`**

ê° LXD dev ì„œë²„ì—ì„œ git pull ì‹¤í–‰:
```makefile
sync-lxd:
	@echo "ğŸ–¥ï¸  LXD ì„œë²„ ì½”ë“œ ì‹±í¬..."
	@lxc exec dev-yj99son  -- bash -c "cd ~/adelie-investment && git pull origin dev/frontend"
	@lxc exec dev-j2hoon10 -- bash -c "cd ~/adelie-investment && git pull origin dev/chatbot"
	@lxc exec dev-ryejinn  -- bash -c "cd ~/adelie-investment && git pull origin dev/pipeline"
	@lxc exec dev-jjjh02   -- bash -c "cd ~/adelie-investment && git pull origin dev/backend"
	@lxc exec dev-hj       -- bash -c "cd ~/adelie-investment && git pull origin dev/infra"
	@echo "âœ… ëª¨ë“  LXD ì„œë²„ ì½”ë“œ ì‹±í¬ ì™„ë£Œ"

sync-all: sync-dev-branches sync-lxd
	@echo "âœ… ì „ì²´ ì‹±í¬ ì™„ë£Œ (ë¸Œëœì¹˜ + LXD ì„œë²„)"
```

**(D) help ë©”ì‹œì§€ì— ì‹ ê·œ íƒ€ê²Ÿ ì¶”ê°€**

**(E) migrate íƒ€ê²Ÿ ê°œì„  â€” venv ê²½ë¡œ ëª…ì‹œ**
```makefile
# ë³€ê²½ ì „
migrate:
	cd database && alembic upgrade head

# ë³€ê²½ í›„
migrate:
	cd database && ../.venv/bin/alembic upgrade head
```

### Step 4: Frontend ì¬ë¹Œë“œ & ì¬ë°°í¬

ì†ì˜ì§„(YJ99Son)ì˜ ìµœì‹  ì»¤ë°‹(c529710, 1dfc826)ì´ ë°°í¬ ë¯¸ë°˜ì˜. frontend ì´ë¯¸ì§€ ì¬ë¹Œë“œ í•„ìš”.

```bash
make build-frontend && make push
ssh deploy-test 'cd ~/adelie-investment && git pull origin develop && \
  docker compose -f docker-compose.prod.yml pull frontend && \
  docker compose -f docker-compose.prod.yml up -d frontend'
```

### Step 5: develop â†’ dev/* ì‹±í¬ & LXD ì„œë²„ ì—…ë°ì´íŠ¸

```bash
# git config ì„¤ì • (ë„í˜•ì¤€ ê³„ì •)
git config user.name "dorae222" && git config user.email "dhj9842@gmail.com"

# ë°©ë²• 1: ìƒˆ Makefile íƒ€ê²Ÿ ì‚¬ìš© (Step 3 ì™„ë£Œ í›„)
make sync-dev-branches
make sync-lxd

# ë°©ë²• 2: ì§ì ‘ ì‹¤í–‰ (Makefile ìˆ˜ì • ì „)
for BRANCH in dev/frontend dev/backend dev/chatbot dev/pipeline dev/infra; do
  git checkout $BRANCH && git merge develop --no-edit && git push origin $BRANCH
done
git checkout develop
```

### Step 6: ì½”ë“œ ì‹±í¬ ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„±

**ìƒˆ íŒŒì¼**: `lxd/docs/sync-guide.md`

ë¸Œëœì¹˜ ê³„ì¸µ êµ¬ì¡°:
```
main â† develop â† dev/frontend â† fix/ui-button
                 dev/backend  â† fix/api-bug
                 dev/chatbot  â† feat/new-tool
                 dev/pipeline â† fix/crawler
                 dev/infra    â† chore/docker-fix
```

ë¬¸ì„œ ì„¹ì…˜:
1. **ë¸Œëœì¹˜ ê³„ì¸µ ë° ì—­í• ** (ë‹´ë‹¹ìë³„ ë§¤í•‘ í…Œì´ë¸”)
2. **ê°œì¸ ì‘ì—… íë¦„** â€” dev/* â†’ fix/* ì„œë¸Œë¸Œëœì¹˜ â†’ í…ŒìŠ¤íŠ¸ â†’ dev/* ë³‘í•©
3. **develop â†’ dev/* ì‹±í¬** â€” ì‘ì—… ì‹œì‘ ì „ ë§¤ë²ˆ ìˆ˜í–‰ (merge ë°©ì‹)
4. **dev/* â†’ develop ë°˜ì˜** â€” PR ìƒì„± ê°€ì´ë“œ
5. **LXD ì„œë²„ ì½”ë“œ ì—…ë°ì´íŠ¸** â€” `make sync-lxd` ë˜ëŠ” ìˆ˜ë™ ëª…ë ¹
6. **ì¶©ëŒ í•´ê²°** ì ˆì°¨
7. **Quick Reference** ëª…ë ¹ì–´ ì¹˜íŠ¸ì‹œíŠ¸

---

## ìˆ˜ì •/ìƒì„± íŒŒì¼ ëª©ë¡

| íŒŒì¼ | ë³€ê²½ ìœ í˜• | ë‚´ìš© |
|------|---------|------|
| `lxd/scripts/setup-dev-env.sh` | ìˆ˜ì • | ë¡œì»¬ DB ì¸ì¦ì •ë³´ 3ê³³ (line 196~227, 308~311, 380) |
| `docker-compose.dev.yml` | ìˆ˜ì • | db-migrate command (line 128) |
| `Makefile` | ìˆ˜ì • | deploy-test ë¸Œëœì¹˜ ìˆ˜ì •, sync/migrate íƒ€ê²Ÿ ì¶”ê°€ |
| `lxd/docs/sync-guide.md` | ì‹ ê·œ | ë¸Œëœì¹˜ ì‹±í¬ ê°€ì´ë“œ ë¬¸ì„œ |

**ì‘ì—… (íŒŒì¼ ë³€ê²½ ì—†ìŒ)**:
- Frontend Docker ì´ë¯¸ì§€ ì¬ë¹Œë“œ & push & deploy-test ì¬ë°°í¬
- dev/* 5ê°œ ë¸Œëœì¹˜ â†’ develop merge & push
- ê° LXD ì„œë²„ `git pull` ì‹¤í–‰

---

## ì‹¤í–‰ ìˆœì„œ

| # | ì‘ì—… | ë‹´ë‹¹ ê³„ì • |
|---|------|---------|
| 1 | `setup-dev-env.sh` ìˆ˜ì • | dorae222 |
| 2 | `docker-compose.dev.yml` ìˆ˜ì • | dorae222 |
| 3 | `Makefile` ìˆ˜ì • | dorae222 |
| 4 | `lxd/docs/sync-guide.md` ì‘ì„± | dorae222 |
| 5 | ì»¤ë°‹ & push (`chore: LXD/Docker ê°œë°œí™˜ê²½ ìˆ˜ì • ë° ì‹±í¬ ìë™í™”`) | dorae222 |
| 6 | Frontend ì¬ë¹Œë“œ â†’ push â†’ deploy-test ì¬ë°°í¬ | dorae222 |
| 7 | dev/* ë¸Œëœì¹˜ 5ê°œ develop merge & push (`make sync-dev-branches`) | dorae222 |
| 8 | LXD ì„œë²„ ì½”ë“œ ì—…ë°ì´íŠ¸ (`make sync-lxd`) | dorae222 |

---

## ê²€ì¦

| í•­ëª© | ê²€ì¦ ë°©ë²• |
|------|---------|
| ë¡œì»¬ DB (LXD local mode) | `docker exec adelie-postgres pg_isready -U narative -d narrative_invest` â†’ accepting |
| dev compose migration | `docker compose -f docker-compose.dev.yml --profile migrate up db-migrate` â†’ exit 0 |
| deploy-test frontend ìµœì‹ í™” | `https://demo.adelie-invest.com` â†’ í¬íŠ¸í´ë¦¬ì˜¤ UI ìµœì‹  (today's commits) |
| dev/* ì‹±í¬ í™•ì¸ | `git log --oneline develop..origin/dev/frontend` â†’ ë¹ˆ ê²°ê³¼ |
| LXD ì„œë²„ ì‹±í¬ í™•ì¸ | `lxc exec dev-yj99son -- bash -c "cd ~/adelie-investment && git log --oneline -1"` â†’ ìµœì‹  ì»¤ë°‹ |
| make sync-dev-branches | ì˜¤ë¥˜ ì—†ì´ 5ê°œ ë¸Œëœì¹˜ push ì™„ë£Œ |
| make sync-lxd | ì˜¤ë¥˜ ì—†ì´ 5ê°œ LXC ì»¨í…Œì´ë„ˆ pull ì™„ë£Œ |


If you need specific details from before exiting plan mode (like exact code snippets, error messages, or content you generated), read the full transcript at: /home/hj/.REDACTED.jsonl

---

ì´ì–´ì„œ ë‚¨ì€ ì‘ì—…ì„ ì§„í–‰í•´ë¼