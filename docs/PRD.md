# Narrative Investment PRD

## "History Repeats Itself" - 역사는 반복된다

**문서 버전**: 1.2  
**최종 수정일**: 2026-02-08  
**작성자**: Narrative Investment Team

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [사용자 플로우](#2-사용자-플로우)
3. [기능 요구사항](#3-기능-요구사항)
4. [데이터 소스](#4-데이터-소스)
5. [기술 아키텍처](#5-기술-아키텍처)
6. [화면 설계](#6-화면-설계)
7. [품질 요구사항](#7-품질-요구사항)
8. [팀 구성](#8-팀-구성)
9. [마일스톤](#9-마일스톤)

---

## 1. 프로젝트 개요

### 1.1 핵심 가치

**"History Repeats Itself"** - 주식 시장의 과거 사례를 통해 현재를 이해하고, 미래를 준비하는 교육 플랫폼

주식 초보자들이 겪는 가장 큰 어려움은 "지금 무슨 일이 일어나고 있는지" 맥락을 이해하지 못하는 것입니다. Narrative Investment는 과거의 유사한 사례를 스토리텔링 방식으로 제공하여, 사용자가 현재 시장 상황을 직관적으로 이해할 수 있도록 돕습니다.

### 1.2 타겟 사용자

| 구분 | 설명 |
|------|------|
| 연령대 | 20-40대 |
| 투자 경험 | 주식 초보자, 재테크 입문자 |
| 니즈 | 쉬운 설명, 맥락 이해, 실제 사례 학습 |
| 디바이스 | 모바일 우선 (스마트폰) |

**페르소나**:
- **김초보 (28세, 직장인)**: 주식 투자를 시작했지만, 뉴스에서 나오는 용어가 어렵고 왜 주가가 오르내리는지 이해하기 어려움
- **이입문 (35세, 프리랜서)**: ETF 투자 중이나, 시장 전체 흐름을 이해하고 싶음. 과거에 비슷한 상황이 있었는지 궁금함

### 1.3 차별점 (TAG)

| 요소 | 설명 |
|------|------|
| **T**ime View | 시간 관점 - 과거-현재 비교를 통한 맥락 이해 |
| **A**ctive Thinking | 능동적 사고 - 질문과 토론을 통한 학습 |
| **G**rounded Learning | 실증적 학습 - 실제 데이터 기반 스토리텔링 |

### 1.4 경쟁 서비스 대비 차별점

| 기존 서비스 | 한계점 | Narrative Investment |
|------------|--------|---------------------|
| 증권사 앱 | 데이터 나열, 맥락 부재 | 스토리텔링 기반 설명 |
| 금융 뉴스 | 전문 용어, 배경 지식 필요 | 3단계 난이도 설명 |
| 유튜브 교육 | 실시간성 부족, 검색 어려움 | 실시간 시장 연동 |
| 투자 커뮤니티 | 검증되지 않은 정보 | 실증적 데이터 기반 |

---

## 2. 사용자 플로우

### 2.1 전체 플로우 개요

```
[Morning Briefing] → [Case Search] → [Story] → [Comparison] → [Companies]
      (1)               (2)           (3)          (4)            (5)
```

사용자는 매일 아침 브리핑에서 시작하여, 관심 있는 키워드나 종목을 선택하고, 과거 사례를 탐색한 후, 스토리를 통해 학습하며, 과거-현재를 비교하고, 관련 기업을 탐색합니다.

### 2.2 단계별 상세

#### Stage 1: Morning Briefing (오늘의 브리핑)

**목적**: 오늘 주목해야 할 키워드와 종목을 한눈에 파악

**기능**:
- 전일 대비 급등/급락 종목 Top 5
- 오늘의 핵심 키워드 3개
- 각 키워드별 간단한 설명 (1-2문장)
- 클릭 시 해당 키워드/종목의 Case Search로 이동

**데이터 소스**: pykrx (전일 종가, 등락률)

**화면 예시**:
```
+----------------------------------+
|  2026년 2월 5일 수요일            |
|  Morning Briefing                |
+----------------------------------+
|  [키워드]                        |
|  - 반도체 수출 호조               |
|  - 환율 변동성 확대               |
|  - AI 관련주 강세                 |
+----------------------------------+
|  [급등 종목]                     |
|  1. 삼성전자 +3.2%               |
|  2. SK하이닉스 +4.1%             |
+----------------------------------+
```

#### Stage 2: Case Search (과거 사례 검색)

**목적**: 선택한 키워드/종목과 유사한 과거 사례 탐색

**기능**:
- 선택한 키워드 기반 과거 사례 검색
- 검색 결과 타임라인 형태로 표시
- 각 사례별 간단한 요약과 당시 시장 상황
- 유사도 점수 표시

**데이터 소스**: Perplexity API (한국 금융 뉴스 검색)

**검색 로직**:
```
1. 키워드 추출 및 확장
2. 시간 범위 설정 (최근 10년)
3. 한국 시장 사례 필터링
4. 유사도 점수 계산
5. 상위 5개 사례 반환
```

#### Stage 3: Story (스토리텔링 학습)

**목적**: 선택한 과거 사례를 스토리텔링 방식으로 학습

**기능**:
- 3단계 난이도 선택 (입문/초급/중급)
- 인터랙티브 텍스트 (용어 클릭 시 설명)
- 핵심 개념 하이라이트
- AI Tutor 질문 버튼

**콘텐츠 구조**:
```
1. 배경 설명 (당시 상황)
2. 사건 발생 (무슨 일이 있었나)
3. 시장 반응 (주가는 어떻게 움직였나)
4. 결과 및 교훈 (어떤 결과가 나왔나)
5. 현재와의 연결 (지금은 어떤 상황인가)
```

**난이도별 차이**:

| 난이도 | 용어 수준 | 설명 깊이 | 예시 |
|--------|----------|----------|------|
| 입문 | 일상 용어 | 비유 중심 | "주가가 떨어진다 = 할인 행사" |
| 초급 | 기본 용어 | 원리 설명 | "PER이 낮다 = 저평가 가능성" |
| 중급 | 전문 용어 | 데이터 포함 | "PER 8.5, PBR 0.9로 업종 평균 대비..." |

#### Stage 4: Comparison (과거-현재 비교)

**목적**: 과거 사례와 현재 상황을 병렬로 비교

**기능**:
- 좌우 분할 뷰 (과거 | 현재)
- 주요 지표 비교 테이블
- 차이점/유사점 하이라이트
- "그때와 지금의 차이" 요약

**비교 항목**:
```
- 시장 상황 (코스피 지수, 거래량)
- 관련 종목 주가 변동
- 환율, 금리 등 매크로 지표
- 투자 심리 (공포/탐욕 지수)
```

#### Stage 5: Companies (관련 기업 탐색)

**목적**: 관련 기업과 공급망 파악

**기능**:
- 관련 기업 리스트 (공급망 기반)
- 기업 간 관계 시각화 (그래프)
- 각 기업별 간단한 설명
- 클릭 시 해당 기업 상세 페이지

**데이터 소스**: Neo4j (기업 관계 그래프)

**관계 유형**:
```
- 공급 관계 (부품 공급, 원자재 공급)
- 경쟁 관계 (동일 업종)
- 모자 관계 (계열사)
- 협력 관계 (합작 투자)
```

---

## 3. 기능 요구사항

### 3.1 Agenda Curation Engine

**목적**: 매일 아침 사용자에게 제공할 키워드와 종목 선정

#### 3.1.1 종목 선정 로직

```python
# 데이터 수집 (pykrx)
- 전일 종가 대비 등락률
- 거래량 변동률
- 시가총액 기준 필터링

# 선정 기준
급등 종목: 등락률 > +3% AND 거래량 > 평균 150%
급락 종목: 등락률 < -3% AND 거래량 > 평균 150%
```

#### 3.1.2 키워드 추출 로직

```python
# 소스
- 선정된 종목의 업종/테마
- 당일 주요 뉴스 헤드라인
- 증권사 리서치 리포트 제목

# 처리
1. 형태소 분석 (명사 추출)
2. 불용어 제거 (금융 도메인 특화)
3. TF-IDF 기반 키워드 추출
4. 클러스터링 및 대표 키워드 선정
```

#### 3.1.3 분류 체계

| 분류 | 설명 | 예시 |
|------|------|------|
| 산업 | 업종별 분류 | 반도체, 자동차, 바이오 |
| 테마 | 투자 테마 | AI, 2차전지, 리오프닝 |
| 이벤트 | 시장 이벤트 | 실적 발표, 금리 결정 |
| 매크로 | 거시 경제 | 환율, 금리, 유가 |

### 3.2 Past-Present Matching

**목적**: 현재 상황과 유사한 과거 사례 검색 및 매칭

#### 3.2.1 검색 전략

```
1. Query 확장
   - 동의어/유의어 추가
   - 관련 키워드 확장
   - 시간 표현 정규화

2. Perplexity API 호출
   - 모델: sonar-pro
   - 언어: 한국어
   - 시간 범위: 최근 10년
   - 도메인: 한국 금융/경제

3. 결과 필터링
   - 한국 시장 관련성 검증
   - 중복 제거
   - 신뢰도 점수 산출
```

#### 3.2.2 유사도 계산

```python
유사도 = w1 * 키워드_일치도 + w2 * 시장상황_유사도 + w3 * 시간적_근접성

# 가중치 기본값
w1 = 0.4  # 키워드 일치도
w2 = 0.4  # 시장 상황 유사도
w3 = 0.2  # 시간적 근접성
```

#### 3.2.3 결과 포맷

```json
{
  "case_id": "2022-semiconductor-shortage",
  "title": "2022년 반도체 공급난",
  "date_range": "2021-06 ~ 2022-12",
  "similarity_score": 0.85,
  "summary": "글로벌 반도체 공급 부족으로 인한...",
  "related_stocks": ["삼성전자", "SK하이닉스"],
  "market_context": {
    "kospi": 2800,
    "exchange_rate": 1200
  }
}
```

### 3.3 Content Generation

**목적**: 스토리텔링 기반 교육 콘텐츠 생성

#### 3.3.1 콘텐츠 생성 파이프라인

```
[과거 사례 데이터] → [프롬프트 구성] → [OpenAI 생성] → [후처리] → [저장]
```

#### 3.3.2 프롬프트 구조

```markdown
## 역할
당신은 주식 초보자를 위한 금융 교육 전문가입니다.

## 작업
다음 과거 사례를 {난이도} 수준으로 설명하세요.

## 사례 정보
- 제목: {title}
- 기간: {date_range}
- 요약: {summary}
- 관련 데이터: {data}

## 출력 형식
1. 배경 (100자 이내)
2. 사건 (200자 이내)
3. 시장 반응 (150자 이내)
4. 교훈 (100자 이내)
5. 현재 연결 (100자 이내)

## 제약 조건
- {난이도}에 맞는 용어 사용
- 비유와 예시 활용
- 긍정적이고 교육적인 톤
```

#### 3.3.3 난이도별 프롬프트 변형

| 난이도 | 추가 지시 |
|--------|----------|
| 입문 | "전문 용어 대신 일상 비유 사용. 예: 주가 하락 → 할인 행사" |
| 초급 | "기본 용어 사용하되 괄호 안에 설명 추가. 예: PER(주가수익비율)" |
| 중급 | "전문 용어와 실제 데이터 포함. 차트 참조 가능" |

#### 3.3.4 후처리

```python
# 용어 하이라이트
- 금융 용어 사전 매칭
- 클릭 가능한 용어로 변환
- 난이도별 설명 연결

# 품질 검증
- 길이 제한 확인
- 금지 표현 필터링
- 팩트 체크 (날짜, 수치)
```

### 3.4 AI Tutor

**목적**: 사용자 질문에 실시간으로 응답하는 대화형 튜터

#### 3.4.1 시스템 구성

```
[사용자 질문] → [컨텍스트 수집] → [프롬프트 구성] → [OpenAI 응답] → [SSE 스트리밍]
```

#### 3.4.2 컨텍스트 수집

```python
context = {
    "current_page": "story",  # 현재 페이지
    "case_id": "2022-semiconductor",  # 보고 있는 사례
    "difficulty": "입문",  # 사용자 난이도
    "previous_qa": [...],  # 이전 대화 히스토리
    "highlighted_term": "PER"  # 클릭한 용어 (있는 경우)
}
```

#### 3.4.3 응답 전략

| 질문 유형 | 처리 방식 |
|----------|----------|
| 용어 질문 | 용어 사전 우선 조회 → 없으면 생성 |
| 사례 질문 | 현재 사례 컨텍스트 활용 |
| 비교 질문 | 과거-현재 데이터 조합 |
| 일반 질문 | 범용 금융 지식 생성 |

#### 3.4.4 응답 포맷

```markdown
## 간단한 답변
{1-2문장 핵심 답변}

## 자세한 설명
{3-5문장 상세 설명}

## 예시
{실제 사례나 비유}

## 관련 질문
- {후속 질문 제안 1}
- {후속 질문 제안 2}
```

### 3.5 Company Relevance

**목적**: 관련 기업과 공급망 관계 분석 및 시각화

#### 3.5.1 Neo4j 그래프 구조

```cypher
// 노드 타입
(:Company {name, stock_code, industry, market_cap})
(:Industry {name, code})
(:Product {name, category})

// 관계 타입
(:Company)-[:SUPPLIES {product, volume}]->(:Company)
(:Company)-[:COMPETES_WITH]->(:Company)
(:Company)-[:BELONGS_TO]->(:Industry)
(:Company)-[:PRODUCES]->(:Product)
```

#### 3.5.2 관계 분석 쿼리

```cypher
// 1차 공급망 조회
MATCH (c:Company {name: $company_name})-[r:SUPPLIES]->(target)
RETURN target.name, r.product, r.volume
ORDER BY r.volume DESC
LIMIT 10

// 경쟁사 조회
MATCH (c:Company {name: $company_name})-[:BELONGS_TO]->(i:Industry)
      <-[:BELONGS_TO]-(competitor)
WHERE competitor.name <> c.name
RETURN competitor.name, competitor.market_cap
ORDER BY competitor.market_cap DESC
LIMIT 5
```

#### 3.5.3 시각화 데이터 포맷

```json
{
  "nodes": [
    {"id": "삼성전자", "type": "company", "size": "large"},
    {"id": "SK하이닉스", "type": "company", "size": "medium"},
    {"id": "반도체", "type": "industry", "size": "small"}
  ],
  "edges": [
    {"source": "삼성전자", "target": "반도체", "type": "belongs_to"},
    {"source": "삼성전자", "target": "SK하이닉스", "type": "competes_with"}
  ]
}
```

---

## 4. 데이터 소스

### 4.1 pykrx (주식 데이터)

**용도**: 실시간/과거 주가 데이터 수집

| 데이터 | API | 주기 |
|--------|-----|------|
| 일별 시세 | `stock.get_market_ohlcv_by_date` | 매일 18:00 |
| 종목 정보 | `stock.get_market_ticker_name` | 주 1회 |
| 시가총액 | `stock.get_market_cap_by_date` | 매일 18:00 |
| 등락률 | `stock.get_market_price_change` | 매일 18:00 |

**데이터 저장**: PostgreSQL `stock_prices` 테이블

### 4.2 네이버 금융 리서치 (증권사 리포트)

**용도**: 증권사 리서치 리포트 PDF 수집 및 분석

| 항목 | 내용 |
|------|------|
| 수집 대상 | 주요 증권사 리포트 (PDF) |
| 수집 주기 | 매일 08:00 |
| 처리 방식 | PDF → Vision API → 텍스트 추출 |
| 저장 위치 | MinIO (PDF 원본), PostgreSQL (추출 텍스트) |

**처리 파이프라인**:
```
[PDF 다운로드] → [MinIO 저장] → [gpt-4o Vision 처리] → [텍스트 추출] → [키워드 추출] → [DB 저장]
```

### 4.3 Perplexity API (과거 사례 검색)

**용도**: 한국 금융 관련 과거 사례 검색

| 설정 | 값 |
|------|---|
| 모델 | sonar-pro |
| 언어 | 한국어 |
| 검색 범위 | 한국 금융/경제 도메인 |
| Rate Limit | 분당 20회 |

**검색 쿼리 예시**:
```
"2020년 코로나 주식 시장 폭락 한국 코스피"
"반도체 공급난 삼성전자 주가 영향 2021년"
```

### 4.4 Neo4j (기업 관계 그래프)

**용도**: 기업 간 공급망, 경쟁 관계 저장 및 분석

| 데이터 소스 | 용도 |
|------------|------|
| DART 공시 | 지분 관계, 계열사 정보 |
| OpenDART XML | 제품/원재료 정보, 공급망 |
| FTC 기업집단 | 대기업 집단 정보 |
| 수동 매핑 | 검증 및 보완 |

**데이터 갱신 주기**: 주 1회 (토요일 새벽)

---

## 5. 기술 아키텍처

### 5.1 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────┐
│                        사용자 (모바일)                           │
└─────────────────────────────────────────────────────────────────┘
                               │
                               ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Frontend (React + Vite)                      │
│                         :3001                                   │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │Briefing │ │ Search  │ │  Story  │ │Compare  │ │Companies│   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
└─────────────────────────────────────────────────────────────────┘
              │                                  │
              ▼                                  ▼
┌─────────────────────────┐    ┌─────────────────────────────────┐
│  Spring Boot (일반 API)  │    │     FastAPI (AI/Data API)       │
│         :8083            │    │           :8082                 │
│  ┌───────────────────┐  │    │  ┌─────────┐  ┌─────────────┐  │
│  │ Auth, Session     │  │    │  │   AI    │  │    Data     │  │
│  │ CRUD Operations   │  │    │  │ Module  │  │  Pipeline   │  │
│  └───────────────────┘  │    │  └─────────┘  └─────────────┘  │
└─────────────────────────┘    └─────────────────────────────────┘
              │                        │              │
              └────────────┬───────────┘              │
                           ▼                          ▼
┌─────────────────────────────────────────────────────────────────┐
│                      인프라 (10.10.10.10)                        │
│  ┌─────────────┐  ┌───────────┐  ┌────────┐  ┌───────────────┐ │
│  │ PostgreSQL  │  │   Neo4j   │  │ Redis  │  │     MinIO     │ │
│  │   + pgvector│  │           │  │        │  │               │ │
│  │    :5432    │  │   :7687   │  │ :6379  │  │     :9000     │ │
│  └─────────────┘  └───────────┘  └────────┘  └───────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 Frontend

#### 5.2.1 기술 스택

| 기술 | 버전 | 용도 |
|------|------|------|
| React | 19 | UI 프레임워크 |
| Vite | 6.x | 빌드 도구 |
| Tailwind CSS | 4.x | 스타일링 |
| framer-motion | 11.x | 애니메이션 |
| React Query | 5.x | 서버 상태 관리 |

#### 5.2.2 디자인 원칙

| 원칙 | 설명 |
|------|------|
| 모바일 우선 | max-width: 480px 기준 설계 |
| 접근성 | WCAG 2.1 AA 준수 |
| 성능 | LCP < 2.5s, FID < 100ms |
| 오프라인 | PWA 지원 (선택적) |

#### 5.2.3 컴포넌트 구조

```
src/
├── components/
│   ├── common/        # 공통 컴포넌트
│   ├── briefing/      # Morning Briefing
│   ├── search/        # Case Search
│   ├── story/         # Story
│   ├── comparison/    # Comparison
│   ├── companies/     # Companies
│   └── tutor/         # AI Tutor
├── hooks/             # 커스텀 훅
├── services/          # API 호출
├── stores/            # 상태 관리
└── styles/            # 전역 스타일
```

### 5.3 Backend

#### 5.3.1 FastAPI (AI/Data API) - :8082

**역할**: AI 기능, 데이터 파이프라인, 외부 API 연동

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/api/briefing/today` | GET | 오늘의 브리핑 조회 |
| `/api/search/cases` | POST | 과거 사례 검색 |
| `/api/story/{case_id}` | GET | 스토리 콘텐츠 조회 |
| `/api/comparison/{case_id}` | GET | 과거-현재 비교 |
| `/api/companies/{case_id}` | GET | 관련 기업 조회 |
| `/api/tutor/chat` | POST | AI Tutor 대화 (SSE) |
| `/api/pipeline/trigger` | POST | 데이터 파이프라인 실행 |

**디렉토리 구조**:
```
backend-api/
├── app/
│   ├── api/routes/       # 라우터
│   ├── core/             # 설정, DB
│   ├── models/           # ORM 모델
│   ├── schemas/          # Pydantic 스키마
│   └── services/         # 비즈니스 로직
├── requirements.txt
└── Dockerfile
```

#### 5.3.2 Spring Boot (일반 API) - :8083

**역할**: 인증, 세션 관리, 사용자 설정 CRUD

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/api/auth/login` | POST | 로그인 |
| `/api/auth/register` | POST | 회원가입 |
| `/api/auth/refresh` | POST | 토큰 갱신 |
| `/api/users/settings` | GET/PUT | 사용자 설정 |
| `/api/bookmarks` | GET/POST/DELETE | 북마크 관리 |
| `/api/history` | GET | 학습 히스토리 |

### 5.4 AI Module

#### 5.4.1 LLM 사용 전략

| LLM | 용도 | 모델 |
|-----|------|------|
| OpenAI | 생성, 요약, Vision | gpt-4o-mini (기본), gpt-4o (복잡) |
| Perplexity | 검색 전용 | sonar-pro |

**선택 기준**:
```python
def select_model(task_type: str) -> str:
    if task_type == "search":
        return "perplexity/sonar-pro"
    elif task_type in ["simple_generation", "summary"]:
        return "openai/gpt-4o-mini"
    elif task_type in ["complex_analysis", "vision"]:
        return "openai/gpt-4o"
    else:
        return "openai/gpt-4o-mini"  # 기본값
```

#### 5.4.2 LangGraph 에이전트

**에이전트 구조**:
```
┌─────────────────────────────────────────────┐
│              Supervisor Agent               │
│         (작업 분류 및 라우팅)                 │
└─────────────────────────────────────────────┘
         │           │           │
         ▼           ▼           ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│  Search     │ │  Content    │ │  Analysis   │
│  Agent      │ │  Agent      │ │  Agent      │
│ (Perplexity)│ │  (OpenAI)   │ │  (OpenAI)   │
└─────────────┘ └─────────────┘ └─────────────┘
```

#### 5.4.3 LangSmith 통합

**관찰 대상**:
- 모든 LLM 호출 (입력/출력/지연시간)
- 에이전트 실행 흐름
- 에러 및 재시도
- 토큰 사용량

**대시보드 항목**:
- 일별 호출 수
- 평균 응답 시간
- 에러율
- 비용 추정

### 5.5 Database

#### 5.5.1 PostgreSQL + pgvector

**스키마**:
```sql
-- 사용자
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    difficulty_level VARCHAR(20) DEFAULT '입문',
    created_at TIMESTAMP DEFAULT NOW()
);

-- 주가 데이터
CREATE TABLE stock_prices (
    id SERIAL PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    open_price DECIMAL(10,2),
    high_price DECIMAL(10,2),
    low_price DECIMAL(10,2),
    close_price DECIMAL(10,2),
    volume BIGINT,
    UNIQUE(stock_code, date)
);

-- 사례
CREATE TABLE cases (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    date_range VARCHAR(50),
    summary TEXT,
    embedding VECTOR(1536),  -- pgvector
    created_at TIMESTAMP DEFAULT NOW()
);

-- 스토리 콘텐츠
CREATE TABLE story_contents (
    id SERIAL PRIMARY KEY,
    case_id INT REFERENCES cases(id),
    difficulty_level VARCHAR(20),
    content JSONB,
    created_at TIMESTAMP DEFAULT NOW()
);
```

#### 5.5.2 Neo4j

**스키마**:
```cypher
// 제약 조건
CREATE CONSTRAINT company_name IF NOT EXISTS
FOR (c:Company) REQUIRE c.name IS UNIQUE;

CREATE CONSTRAINT industry_code IF NOT EXISTS
FOR (i:Industry) REQUIRE i.code IS UNIQUE;

// 인덱스
CREATE INDEX company_stock_code IF NOT EXISTS
FOR (c:Company) ON (c.stock_code);
```

#### 5.5.3 Redis

**용도**:
- 세션 캐싱
- 브리핑 데이터 캐싱 (TTL: 6시간)
- Rate Limiting

**키 구조**:
```
session:{user_id}           # 세션 데이터
briefing:2026-02-05         # 일별 브리핑 캐시
rate_limit:{user_id}:{api}  # Rate Limit 카운터
```

#### 5.5.4 MinIO

**용도**: PDF 파일 저장

**버킷 구조**:
```
research-reports/
├── 2026/
│   ├── 02/
│   │   ├── 05/
│   │   │   ├── report_001.pdf
│   │   │   └── report_002.pdf
```

---

## 6. 화면 설계

### 6.1 온보딩

**목적**: 앱 소개 및 난이도 설정

**화면 구성**:
```
┌─────────────────────────┐
│                         │
│    [필기체 로고]         │
│   narrative investment  │
│                         │
│   "역사는 반복됩니다"    │
│                         │
│   ┌─────────────────┐   │
│   │ 시작하기        │   │
│   └─────────────────┘   │
│                         │
└─────────────────────────┘
```

**필기체 로고 테마**:
- 폰트: 손글씨 스타일 (Nanum Pen Script 또는 커스텀)
- 색상: 다크 그레이 (#333)
- 애니메이션: 글씨 쓰기 효과 (framer-motion)

### 6.2 메인 (Briefing)

**목적**: 오늘의 핵심 정보 한눈에 파악

**화면 구성**:
```
┌─────────────────────────┐
│ 2026.02.05 수요일        │
├─────────────────────────┤
│ [오늘의 키워드]          │
│ ┌─────────────────────┐ │
│ │ 반도체 수출 호조    → │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ 환율 변동성 확대    → │ │
│ └─────────────────────┘ │
│ ┌─────────────────────┐ │
│ │ AI 관련주 강세      → │ │
│ └─────────────────────┘ │
├─────────────────────────┤
│ [급등/급락 종목]         │
│ ┌───────┐ ┌───────┐    │
│ │삼성전자│ │LG화학 │    │
│ │ +3.2% │ │ -2.8% │    │
│ └───────┘ └───────┘    │
└─────────────────────────┘
```

**카드 디자인**:
- 배경: 그라데이션 (키워드 유형별 색상)
- 모서리: 둥근 모서리 (12px)
- 그림자: 부드러운 그림자
- 터치 피드백: 눌림 효과

### 6.3 검색 결과 (Search)

**목적**: 과거 사례 타임라인 표시

**화면 구성**:
```
┌─────────────────────────┐
│ ← 반도체 수출 호조       │
├─────────────────────────┤
│ [타임라인]               │
│                         │
│ 2022.06 ─●─ 반도체 슈퍼사이클
│          │   유사도 85%
│          │
│ 2018.09 ─●─ 메모리 반도체 호황
│          │   유사도 72%
│          │
│ 2010.03 ─●─ IT 수출 급증
│              유사도 65%
│                         │
└─────────────────────────┘
```

**타임라인 뷰**:
- 세로 타임라인 (최신순)
- 유사도 점수 표시
- 탭하여 상세 이동

### 6.4 스토리 (Story)

**목적**: 인터랙티브 스토리텔링

**화면 구성**:
```
┌─────────────────────────┐
│ ← 2022년 반도체 슈퍼사이클 │
├─────────────────────────┤
│ [입문] [초급] [중급]     │
├─────────────────────────┤
│                         │
│ 2022년, 전 세계가 반도체 │
│ 부족으로 고통받았습니다. │
│                         │
│ [PER]은 역대 최고 수준   │
│ 이었고...               │
│                         │
│ ┌─────────────────────┐ │
│ │ PER이 뭔가요?    ? │ │
│ └─────────────────────┘ │
│                         │
└─────────────────────────┘
│ [AI Tutor에게 질문하기]  │
└─────────────────────────┘
```

**인터랙티브 텍스트**:
- 용어 클릭 시 툴팁
- 하이라이트 색상
- 플로팅 질문 버튼

### 6.5 비교 (Comparison)

**목적**: 과거-현재 병렬 비교

**화면 구성**:
```
┌─────────────────────────┐
│ ← 과거 vs 현재          │
├────────────┬────────────┤
│   2022년   │   2026년   │
├────────────┼────────────┤
│ 코스피     │ 코스피     │
│ 2,800      │ 3,150      │
├────────────┼────────────┤
│ 환율       │ 환율       │
│ 1,200원    │ 1,350원    │
├────────────┼────────────┤
│ 삼성전자   │ 삼성전자   │
│ 68,000원   │ 82,000원   │
├────────────┴────────────┤
│ [차이점 분석]            │
│ • 환율이 12.5% 상승      │
│ • 금리 환경 다름         │
└─────────────────────────┘
```

**병렬 뷰**:
- 좌우 스크롤 동기화
- 차이점 하이라이트
- 요약 카드

### 6.6 AI Tutor

**목적**: 실시간 질문 응답

**화면 구성**:
```
┌─────────────────────────┐
│ [기존 화면]              │
│                         │
│                         │
├─────────────────────────┤
│ ▼ AI Tutor              │
├─────────────────────────┤
│ PER이 뭔가요?            │
├─────────────────────────┤
│                         │
│ PER(주가수익비율)은      │
│ 주가를 1주당 순이익으로  │
│ 나눈 값입니다.           │
│                         │
│ 쉽게 말해, 투자금을 회수 │
│ 하는 데 걸리는 시간...   │
│                         │
├─────────────────────────┤
│ ┌─────────────────────┐ │
│ │ 질문을 입력하세요    │ │
│ └─────────────────────┘ │
└─────────────────────────┘
```

**슬라이드업 모달**:
- 바텀 시트 스타일
- 드래그로 닫기
- SSE 스트리밍 응답
- 이전 대화 유지

---

## 7. 품질 요구사항

### 7.1 AI 응답 품질

#### 7.1.1 LangSmith 측정 항목

| 항목 | 측정 방법 | 목표값 |
|------|----------|--------|
| 정확도 | 팩트 체크 테스트 | > 95% |
| 일관성 | 동일 질문 반복 테스트 | > 90% |
| 관련성 | 컨텍스트 적합성 평가 | > 85% |
| 완전성 | 필수 정보 포함 여부 | > 90% |

#### 7.1.2 환각 테스트

**테스트 케이스**:
```
1. 존재하지 않는 종목 코드 질문
2. 미래 날짜의 주가 질문
3. 가짜 경제 이벤트 검증
4. 잘못된 수치 제시 후 확인
```

**평가 기준**:
- 환각 발생률 < 5%
- 불확실성 표현 사용 여부
- 출처 제시 여부

#### 7.1.3 프롬프트 품질 관리

```
1. 버전 관리 (Git)
2. A/B 테스트
3. 정기 리뷰 (주 1회)
4. 사용자 피드백 반영
```

### 7.2 성능 요구사항

| 항목 | 목표값 | 측정 방법 |
|------|--------|----------|
| 첫 화면 로딩 | < 2초 | LCP |
| API 응답 시간 | < 3초 | 95 percentile |
| AI 스트리밍 시작 | < 1초 | TTFB |
| 검색 결과 표시 | < 5초 | End-to-end |

### 7.3 안정성 요구사항

| 항목 | 목표값 |
|------|--------|
| 가용성 | 99.5% |
| 에러율 | < 1% |
| 크래시율 | < 0.1% |

### 7.4 보안 요구사항

| 항목 | 구현 |
|------|------|
| 인증 | JWT + Refresh Token |
| 통신 | HTTPS 필수 |
| API 키 | 환경 변수 관리 |
| Rate Limiting | Redis 기반 |

---

## 8. 팀 구성

### 8.1 팀원 역할

| 역할 | 이름 | 담당 업무 |
|------|------|----------|
| 팀장 | 손영진 | 기획, React UI, 프로젝트 관리 |
| AI 개발 | 정지훈 | FastAPI, LangGraph, AI 서비스 |
| AI QA | 안례진 | AI 테스트, 프롬프트 엔지니어링, LangSmith |
| 백엔드 | 허진서 | Spring Boot API, 인증, DB 설계 |
| 인프라 | 도형준 | Docker, CI/CD, 인프라 운영 |

### 8.2 역할별 상세

#### 손영진 (팀장)
- 제품 기획 및 요구사항 정의
- React 프론트엔드 개발
- UI/UX 설계
- 스프린트 관리

#### 정지훈 (AI 개발)
- FastAPI 서버 개발
- LangGraph 에이전트 구현
- OpenAI/Perplexity 연동
- AI 서비스 최적화

#### 안례진 (AI QA)
- 프롬프트 엔지니어링
- AI 응답 품질 테스트
- LangSmith 대시보드 관리
- 환각 테스트 설계/실행

#### 허진서 (백엔드)
- Spring Boot API 개발
- JWT 인증 구현
- PostgreSQL/Neo4j 스키마 설계
- API 문서화

#### 도형준 (인프라)
- Docker 컨테이너화
- CI/CD 파이프라인 구축
- 서버 모니터링
- 배포 자동화

### 8.3 협업 도구

| 용도 | 도구 |
|------|------|
| 코드 관리 | GitHub |
| 이슈 관리 | GitHub Issues |
| 문서 | GitHub Wiki, Notion |
| 커뮤니케이션 | Slack |
| 디자인 | Figma |

---

## 9. 마일스톤

### Phase 1: 기본 구조 설정

**목표**: 프로젝트 기반 구조 완성

**주요 작업**:
- [ ] 프로젝트 초기화 (React, FastAPI, Spring Boot)
- [ ] 개발 환경 설정 (Docker, .env)
- [ ] CI/CD 파이프라인 구축
- [ ] DB 스키마 설계 및 마이그레이션
- [ ] 기본 API 엔드포인트 (health check)

**산출물**:
- 실행 가능한 개발 환경
- DB 스키마 문서
- API 기본 구조

---

### Phase 2: 데이터 파이프라인

**목표**: 주식 데이터 수집 및 저장 자동화

**주요 작업**:
- [ ] pykrx 데이터 수집 스크립트
- [ ] 네이버 금융 리서치 PDF 수집
- [ ] PDF Vision 처리 파이프라인
- [ ] Neo4j 그래프 데이터 로딩
- [ ] 스케줄러 설정 (cron)

**산출물**:
- 자동화된 데이터 수집
- 데이터 품질 리포트
- 파이프라인 모니터링

---

### Phase 3: 핵심 기능 구현

**목표**: Morning Briefing ~ Companies 5단계 구현

**주요 작업**:
- [ ] Agenda Curation Engine
- [ ] Past-Present Matching (Perplexity 연동)
- [ ] Content Generation (OpenAI 연동)
- [ ] 프론트엔드 5개 화면 개발
- [ ] API 연동 및 통합 테스트

**산출물**:
- 동작하는 5단계 플로우
- 프론트엔드 화면
- 통합 테스트 결과

---

### Phase 4: AI Tutor

**목표**: 대화형 AI 튜터 구현

**주요 작업**:
- [ ] LangGraph 에이전트 구현
- [ ] SSE 스트리밍 연동
- [ ] 컨텍스트 관리 시스템
- [ ] 프론트엔드 AI Tutor UI
- [ ] 대화 히스토리 저장

**산출물**:
- 동작하는 AI Tutor
- 대화 품질 리포트
- 사용자 테스트 결과

---

### Phase 5: 테스트 및 최적화

**목표**: 품질 확보 및 성능 최적화

**주요 작업**:
- [ ] LangSmith 대시보드 구축
- [ ] 환각 테스트 실행
- [ ] 성능 최적화 (캐싱, 쿼리 튜닝)
- [ ] 사용자 테스트 (베타)
- [ ] 버그 수정 및 안정화

**산출물**:
- 품질 리포트
- 성능 벤치마크
- 베타 피드백 반영

---

## 부록

### A. 용어 정의

| 용어 | 정의 |
|------|------|
| 브리핑 | 오늘의 핵심 키워드/종목 요약 |
| 사례 | 과거 유사한 시장 상황 |
| 스토리 | 사례를 스토리텔링으로 설명한 콘텐츠 |
| 난이도 | 용어 수준 (입문/초급/중급) |
| AI Tutor | 실시간 질문 응답 기능 |

### B. 참고 문서

- [시스템 아키텍처 문서](./architecture.md)
- [API 레퍼런스](./api-reference.md)
- [DB 스키마 문서](./database-schema.md)
- [디자인 가이드](./design-guide.md)

### C. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-02-05 | Team | 초기 버전 작성 |
| 1.1 | 2026-02-06 | Team | UI 플로우 및 API 엔드포인트 추가 |
| 1.2 | 2026-02-08 | Team | 데이터 생성 파이프라인 추가 (generate_cases.py), mark 태그 렌더링 개선 |

---

## UI 플로우

### 메인 학습 플로우

```
온보딩 → 홈(키워드 선택) → 매칭 결과 → 스토리 → 비교 분석 → 관련 기업 → 홈
```

### 페이지별 기능 명세

| 페이지 | 경로 | 핵심 기능 |
|--------|------|-----------|
| 온보딩 | /onboarding | 투자 경험 수준 선택 (입문/초급/중급) |
| 홈 | / | 오늘의 키워드 3개 표시, START BRIEFING |
| 매칭 | /matching | SYNC RATE 표시, 과거 사례 매칭 결과, KEY INSIGHT |
| 스토리 | /story | 역사적 사례 내러티브, Thinking Point, 용어 하이라이트 |
| 비교 분석 | /comparison | PER 차트 비교, 본문 분석, 의견 투표 |
| 관련 기업 | /companies | 역할별(대장주/장비주/잠룡) 기업 분류 |
| 검색 | /search | 키워드 자유 검색 |
| 히스토리 | /history | 학습 이력 조회 |

### API 엔드포인트

| Method | Path | 설명 |
|--------|------|------|
| GET | /api/v1/health | 헬스체크 |
| GET | /api/v1/briefing/today | 오늘의 브리핑 |
| GET | /api/v1/glossary | 용어집 조회 |
| GET | /api/v1/search/cases | 역사적 사례 검색 |
| POST | /api/v1/tutor/chat | AI 튜터 채팅 (SSE) |
| GET | /api/v1/tutor/explain/{term} | 용어 설명 |
| POST | /api/v1/pipeline/trigger | 파이프라인 실행 |
| POST | /api/v1/highlight | 용어 하이라이팅 |
| GET | /api/v1/story/{case_id} | 스토리 콘텐츠 |
| GET | /api/v1/comparison/{case_id} | 비교 분석 |
| GET | /api/v1/companies/{case_id} | 관련 기업 |
