# 한국투자증권 KIS Open Trading API 조사 결과

**조사 일자**: 2026년 2월 8일

## 1. API 키당 여러 모의투자 계좌 지원 여부

### 현재 확인된 정보
- **공식 문서에 명시적 언급 없음**: 하나의 API 키로 여러 모의투자 계좌를 동시에 사용할 수 있는지에 대한 명확한 문서를 찾지 못했습니다.
- **계좌별 인증 구조**: KIS Open API는 계좌번호(CANO)와 계좌상품코드(ACNT_PRDT_CD)를 기반으로 동작합니다.
- **API 키 구조**: 
  - 실전투자용 앱키/앱시크릿과 모의투자용 앱키/앱시크릿이 **별도로 발급**됩니다.
  - 각 계좌 타입별로 별도의 자격증명이 필요합니다.

### 추정
- 하나의 API 키는 특정 계좌와 연결되어 있는 것으로 보입니다.
- 여러 모의투자 계좌를 사용하려면 각 계좌마다 별도의 API 키를 발급받아야 할 가능성이 높습니다.

**권장사항**: 한국투자증권 개발자센터(apiportal.koreainvestment.com) 또는 고객센터에 직접 문의하여 확인하시기 바랍니다.

---

## 2. KIS API Rate Limits (호출 제한)

### REST API 호출 제한

| 환경 | 초당 호출 제한 | 비고 |
|------|---------------|------|
| **실전투자 (Real Trading)** | **20건/초** | 계좌 단위로 적용 |
| **모의투자 (Mock Trading)** | **2건/초** | 계좌 단위로 적용 |
| **토큰 발급** | **1건/초** | 원칙적으로 하루 1회 발급 (유효기간 내 반복 발급 시 제한 가능) |

### 추가 제한사항
- **API별 개별 제한**: 일부 API는 더 엄격한 제한이 있을 수 있습니다.
  - 예: 주식 당일분봉조회 API는 초당 20개 제한
  - 예: 미국주식 차트 API는 초당 10회 제한
- **에러 코드**: 호출 제한 초과 시 `EGW00201` 에러 코드 반환
- **슬라이딩 윈도우 방식**: 한국투자증권은 슬라이딩 윈도우 방식으로 호출량을 제한하는 것으로 추정됩니다.

### 참고 자료
- 공지사항: "API 호출유량안내(REST, 웹소켓) (2025.08.07 기준)" - apiportal.koreainvestment.com
- 개발자 블로그: 쓰로틀링을 통한 한국투자증권 API 호출 유량 제한 정책 대응

---

## 3. 모의투자(모의투자) 엔드포인트

### 확인된 정보
- **모의투자 환경 지원**: KIS Open API는 모의투자 환경을 명시적으로 지원합니다.
- **환경 전환**: `change_trading_env()` 또는 `svr="vps"` 파라미터를 통해 모의투자 환경으로 전환 가능합니다.
- **별도 자격증명**: 모의투자용 앱키/앱시크릿이 별도로 필요합니다.

### 엔드포인트 구조
- 모의투자와 실전투자는 동일한 엔드포인트를 사용하되, **서버 환경 파라미터**로 구분됩니다.
- 실전투자: `svr="prod"` 또는 `env_dv="real"`
- 모의투자: `svr="vps"` 또는 `env_dv="virtual"`

### 주요 모의투자 기능
- 주식 시세 조회
- 주식 주문 (매수/매도)
- 잔고 조회
- 체결 내역 조회
- (실전투자와 동일한 API 세트 사용)

**상세 엔드포인트 목록**: 공식 API 가이드 문서 (apiportal.koreainvestment.com/apiservice-apiservice) 참조 필요

---

## 4. 하나의 API 키로 동시 사용 가능한 사용자 수 제한

### 현재 확인된 정보
- **공식 문서에 명시적 언급 없음**: 하나의 API 키로 동시에 몇 명의 사용자가 사용할 수 있는지에 대한 명확한 제한이 문서화되어 있지 않습니다.
- **계좌 단위 제한**: Rate limit은 **계좌 단위**로 적용됩니다.
- **API 키와 계좌의 관계**: API 키는 특정 계좌와 연결되어 있는 것으로 보입니다.

### 추정
- 하나의 API 키 = 하나의 계좌로 제한될 가능성이 높습니다.
- 여러 사용자가 동시에 사용하려면 각 사용자마다 별도의 계좌와 API 키가 필요할 수 있습니다.

**권장사항**: 한국투자증권 개발자센터에 직접 문의하여 확인하시기 바랍니다.

---

## 5. 40명의 사용자 서비스 가능 여부 분석

### 시나리오: 하나의 API 키로 40명의 사용자 서비스

#### 제약사항 분석

**1. Rate Limit 제약**
- 모의투자 환경: **초당 2건** 제한
- 40명의 사용자가 동시에 요청하는 경우:
  - 각 사용자가 초당 1회 요청 시: 초당 40건 필요 → **제한 초과**
  - 각 사용자가 분당 1회 요청 시: 초당 약 0.67건 → **가능하나 매우 제한적**

**2. 동시성 문제**
- 40명의 사용자가 동시에 주문을 넣거나 시세를 조회하는 경우:
  - Rate limit 초과로 인한 에러 발생 가능성 높음
  - 재시도 로직 필요하나, 사용자 경험 저하

**3. 계좌 제한**
- 하나의 API 키가 하나의 계좌에만 연결된다면:
  - 40명의 사용자가 하나의 계좌를 공유해야 함
  - 개별 잔고/주문 관리 불가능

### 대안 방안

**방안 1: 여러 API 키 사용**
- 각 사용자 또는 사용자 그룹마다 별도의 모의투자 계좌와 API 키 발급
- 장점: 개별 계좌 관리, Rate limit 분산
- 단점: API 키 관리 복잡도 증가

**방안 2: 큐 시스템 및 쓰로틀링 구현**
- 서버 측에서 요청을 큐에 넣고 Rate limit에 맞춰 순차 처리
- 장점: 하나의 API 키로 여러 사용자 서비스 가능
- 단점: 응답 지연 발생, 실시간성 저하

**방안 3: 캐싱 전략**
- 시세 데이터는 캐싱하여 중복 요청 최소화
- 장점: API 호출 수 감소
- 단점: 실시간성 저하, 주문은 캐싱 불가

**방안 4: 제휴 API 신청**
- 한국투자증권과 제휴하여 더 높은 Rate limit 협상
- 장점: 공식적인 해결책
- 단점: 제휴 프로세스 필요, 승인 필요

### 결론 및 권장사항

**현실적인 평가**:
- 하나의 API 키로 40명의 사용자를 서비스하는 것은 **매우 어렵습니다**.
- 모의투자 환경의 초당 2건 제한은 40명의 동시 사용자에게는 충분하지 않습니다.

**권장 접근법**:
1. **단기**: 쓰로틀링 및 큐 시스템 구현으로 하나의 API 키 사용 (제한적 서비스)
2. **중기**: 여러 모의투자 계좌 개설 및 API 키 발급 (사용자 그룹별 분산)
3. **장기**: 한국투자증권과 제휴하여 Rate limit 상향 협상

**필수 확인 사항**:
- 한국투자증권에 직접 문의하여 다음 사항 확인:
  1. 하나의 API 키로 여러 모의투자 계좌 사용 가능 여부
  2. 제휴 API를 통한 Rate limit 상향 가능 여부
  3. 대량 사용자 서비스를 위한 권장 아키텍처

---

## 6. 참고 자료 및 링크

### 공식 문서
- **KIS Developers 포털**: https://apiportal.koreainvestment.com/
- **API 가이드 문서**: https://apiportal.koreainvestment.com/apiservice-apiservice
- **GitHub 샘플 코드**: https://github.com/koreainvestment/open-trading-api
- **FAQ**: https://apiportal.koreainvestment.com/faq-faq
- **제휴 안내**: https://apiportal.koreainvestment.com/provider-info

### 개발자 자료
- **쓰로틀링 구현 예제**: https://hky035.github.io/web/kis-api-throttling/
- **API 호출 유량 제어**: https://velog.io/@han97901/API-%EC%9C%A0%EB%9F%89-%EC%A0%9C%EC%96%B4-%EA%B3%A0%EB%AF%BC

### 문의 채널
- **고객의 소리**: 한국투자증권 홈페이지 로그인 후 '고객의 소리' 페이지
- **AI 챗봇**: https://chatgpt.com/g/g-68b920ee7afc8191858d3dc05d429571-hangugtujajeunggweon-open-api-seobiseu-gpts
- **TESTBED**: https://apiportal.koreainvestment.com/testbed-intro

---

## 7. 추가 조사 필요 사항

다음 사항들은 한국투자증권에 직접 문의하여 확인이 필요합니다:

1. ✅ **하나의 API 키로 여러 모의투자 계좌 사용 가능 여부**
2. ✅ **제휴 API를 통한 Rate limit 상향 가능 여부 및 조건**
3. ✅ **대량 사용자 서비스를 위한 권장 아키텍처**
4. ✅ **웹소켓 연결 제한 (실시간 시세용)**
5. ✅ **동시 접속자 수 제한 (있는 경우)**

---

**작성일**: 2026년 2월 8일  
**다음 업데이트**: 한국투자증권 공식 답변 수신 시
